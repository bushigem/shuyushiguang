# 图书管理系统数据库结构 (Markdown 格式)

## 表结构

### 表: categories (书籍分类表)

| 字段名 (Column Name) | 数据类型 (Data Type) | 约束 (Constraints)                                      | 备注 (Comment) |
| -------------------- | -------------------- | ------------------------------------------------------- | -------------- |
| category_id          | INT                  | PRIMARY KEY, AUTO_INCREMENT                             | 分类ID         |
| name                 | VARCHAR(100)         | NOT NULL, UNIQUE                                        | 分类名称       |
| created_at           | TIMESTAMP            | DEFAULT CURRENT_TIMESTAMP                               | 创建时间       |
| updated_at           | TIMESTAMP            | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 最后更新时间   |

### 表: locations (书籍存放位置表)

| 字段名 (Column Name) | 数据类型 (Data Type) | 约束 (Constraints)                                      | 备注 (Comment)                     |
| -------------------- | -------------------- | ------------------------------------------------------- | ---------------------------------- |
| location_id          | INT                  | PRIMARY KEY, AUTO_INCREMENT                             | 位置ID                             |
| name                 | VARCHAR(100)         | NOT NULL, UNIQUE                                        | 位置名称 (如图书馆区域、书架号) |
| description          | TEXT                 |                                                         | 位置描述                           |
| created_at           | TIMESTAMP            | DEFAULT CURRENT_TIMESTAMP                               | 创建时间                           |
| updated_at           | TIMESTAMP            | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 最后更新时间                       |

### 表: users (用户信息表 - 包含所有角色)

| 字段名 (Column Name) | 数据类型 (Data Type)                   | 约束 (Constraints)                                      | 备注 (Comment)                 |
| -------------------- | -------------------------------------- | ------------------------------------------------------- | ------------------------------ |
| user_id              | INT                                    | PRIMARY KEY, AUTO_INCREMENT                             | 用户ID                         |
| username             | VARCHAR(50)                            | NOT NULL, UNIQUE                                        | 登录用户名                     |
| password_hash        | VARCHAR(255)                           | NOT NULL                                                | 加密后的密码 (应存储哈希值)    |
| role                 | ENUM('super_admin', 'admin', 'student') | NOT NULL                                                | 用户角色/分组                  |
| name                 | VARCHAR(100)                           | NOT NULL                                                | 姓名                           |
| department           | VARCHAR(100)                           |                                                         | 院系 (管理员和学生需要)        |
| position             | VARCHAR(100)                           |                                                         | 职务 (仅管理员需要)            |
| student_id           | VARCHAR(50)                            | UNIQUE                                                  | 学号 (仅学生需要, 需唯一)    |
| email                | VARCHAR(100)                           | UNIQUE                                                  | 邮箱 (可选, 唯一)            |
| phone                | VARCHAR(20)                            |                                                         | 电话 (可选)                    |
| is_active            | BOOLEAN                                | DEFAULT TRUE                                            | 账户是否激活                   |
| created_at           | TIMESTAMP                              | DEFAULT CURRENT_TIMESTAMP                               | 创建时间                       |
| updated_at           | TIMESTAMP                              | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 最后更新时间                   |

### 表: books (书籍信息表)

| 字段名 (Column Name) | 数据类型 (Data Type)                                             | 约束 (Constraints)                                                           | 备注 (Comment)                 |
| -------------------- | ---------------------------------------------------------------- | ---------------------------------------------------------------------------- | ------------------------------ |
| book_id              | INT                                                              | PRIMARY KEY, AUTO_INCREMENT                                                  | 书籍ID                         |
| title                | VARCHAR(255)                                                     | NOT NULL                                                                     | 书名                           |
| isbn                 | VARCHAR(20)                                                      | NOT NULL, UNIQUE                                                             | ISBN 号                        |
| author               | VARCHAR(255)                                                     |                                                                              | 作者                           |
| publisher            | VARCHAR(255)                                                     |                                                                              | 出版社                         |
| publish_date         | DATE                                                             |                                                                              | 出版日期                       |
| description          | TEXT                                                             |                                                                              | 简介                           |
| image_url            | VARCHAR(512)                                                     |                                                                              | 书籍封面图片 URL 或路径        |
| category_id          | INT                                                              | FOREIGN KEY (categories.category_id) ON DELETE SET NULL ON UPDATE CASCADE | 外键: 关联书籍分类             |
| location_id          | INT                                                              | FOREIGN KEY (locations.location_id) ON DELETE SET NULL ON UPDATE CASCADE | 外键: 关联书籍位置             |
| status               | ENUM('available', 'borrowed', 'lost', 'damaged', 'reserved')     | NOT NULL, DEFAULT 'available'                                                | 书籍状态                       |
| added_at             | TIMESTAMP                                                        | DEFAULT CURRENT_TIMESTAMP                                                    | 入库时间                       |
| updated_at           | TIMESTAMP                                                        | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP                        | 最后更新时间                   |

### 表: borrowing_records (书籍借阅记录表)

| 字段名 (Column Name) | 数据类型 (Data Type) | 约束 (Constraints)                                                            | 备注 (Comment)                     |
| -------------------- | -------------------- | ----------------------------------------------------------------------------- | ---------------------------------- |
| borrow_id            | INT                  | PRIMARY KEY, AUTO_INCREMENT                                                   | 借阅记录ID                         |
| book_id              | INT                  | NOT NULL, FOREIGN KEY (books.book_id) ON DELETE RESTRICT ON UPDATE CASCADE  | 外键: 关联书籍                     |
| user_id              | INT                  | NOT NULL, FOREIGN KEY (users.user_id) ON DELETE RESTRICT ON UPDATE CASCADE  | 外键: 关联借阅用户                 |
| borrow_date          | TIMESTAMP            | NOT NULL, DEFAULT CURRENT_TIMESTAMP                                           | 借出日期                           |
| due_date             | DATE                 | NOT NULL                                                                      | 应还日期                           |
| return_date          | DATE                 | DEFAULT NULL                                                                  | 实际归还日期 (NULL 表示未归还) |
| created_at           | TIMESTAMP            | DEFAULT CURRENT_TIMESTAMP                                                     | 创建时间                           |
| updated_at           | TIMESTAMP            | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP                         | 最后更新时间                       |

---

## 视图结构

### 视图: view_currently_borrowed (当前在借图书)

该视图查询 `borrowing_records` 表中 `return_date` 为 NULL 的记录，并关联 `books` 和 `users` 表获取详细信息。

| 字段名 (Column Name) | 来源表.字段 (Source Table.Column) / 别名 | 备注 (Comment)       |
| -------------------- | ---------------------------------------- | -------------------- |
| borrow_id            | borrowing_records.borrow_id              | 借阅记录ID           |
| borrow_date          | borrowing_records.borrow_date            | 借出日期             |
| due_date             | borrowing_records.due_date               | 应还日期             |
| book_id              | books.book_id                            | 书籍ID               |
| book_title           | books.title                              | 书籍标题             |
| isbn                 | books.isbn                               | 书籍ISBN             |
| user_id              | users.user_id                            | 用户ID               |
| user_name            | users.name                               | 用户姓名             |
| student_id           | users.student_id                         | 学生学号 (若适用)    |
| user_department      | users.department                         | 用户院系 (若适用)    |

### 视图: view_overdue_books (逾期未还图书)

该视图查询 `borrowing_records` 表中 `return_date` 为 NULL 且 `due_date` 早于当前日期的记录，并关联 `books` 和 `users` 表获取详细信息，同时计算逾期天数。

| 字段名 (Column Name) | 来源表.字段 (Source Table.Column) / 计算 / 别名 | 备注 (Comment)       |
| -------------------- | --------------------------------------------- | -------------------- |
| borrow_id            | borrowing_records.borrow_id                   | 借阅记录ID           |
| borrow_date          | borrowing_records.borrow_date                 | 借出日期             |
| due_date             | borrowing_records.due_date                    | 应还日期             |
| days_overdue         | DATEDIFF(CURDATE(), borrowing_records.due_date) | 逾期天数             |
| book_id              | books.book_id                                 | 书籍ID               |
| book_title           | books.title                                   | 书籍标题             |
| isbn                 | books.isbn                                    | 书籍ISBN             |
| user_id              | users.user_id                                 | 用户ID               |
| user_name            | users.name                                    | 用户姓名             |
| student_id           | users.student_id                              | 学生学号 (若适用)    |
| user_department      | users.department                              | 用户院系 (若适用)    |
| user_phone           | users.phone                                   | 用户电话 (若适用)    |
| user_email           | users.email                                   | 用户邮箱 (若适用)    |